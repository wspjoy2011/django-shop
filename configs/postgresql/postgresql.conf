#------------------------------------------------------------------------------
# Connections & Authentication
#------------------------------------------------------------------------------
listen_addresses = '*'
max_connections = 100

#------------------------------------------------------------------------------
# Memory & Shared Memory Configuration
#------------------------------------------------------------------------------
# Shared buffer pool for caching table/index pages
shared_buffers = 4GB
dynamic_shared_memory_type = posix

# Memory for sorts/hashes per operation
work_mem = 64MB

# Memory for maintenance operations (VACUUM, CREATE INDEX, REINDEX)
maintenance_work_mem = 1GB

# Planner memory hint: how much data can be cached in RAM (OS cache + shared_buffers)
effective_cache_size = 12GB

#------------------------------------------------------------------------------
# WAL & Checkpoints
#------------------------------------------------------------------------------
max_wal_size = 1GB
min_wal_size = 80MB

# Spread checkpoints to avoid I/O spikes and latency jitter
checkpoint_timeout = 15min
checkpoint_completion_target = 0.9

# Compress full-page images in WAL to reduce write volume (best on SSD/NVMe)
wal_compression = lz4

# Make WAL writer flush more frequently in smaller batches
wal_writer_delay = 20ms

#------------------------------------------------------------------------------
# Query Planner & Optimizer
#------------------------------------------------------------------------------
# On NVMe storage, random I/O is nearly as fast as sequential
random_page_cost = 1.1

# Better cardinality estimates for complex predicates (IN, skewed data, joins)
default_statistics_target = 500

# JIT compilation (disable if CPU is better used for queries themselves)
jit = off

# Enable asynchronous prefetching for bitmap/seq scans
effective_io_concurrency = 200

#------------------------------------------------------------------------------
# Parallel Query Execution
#------------------------------------------------------------------------------
# Allow a single query to use more parallel workers for scans/joins/aggregates
max_parallel_workers_per_gather = 4

# Upper cap for all parallel workers that queries may use across the server
max_parallel_workers = 8

# Total background workers Postgres may start (must be >= max_parallel_workers)
max_worker_processes = 16

#------------------------------------------------------------------------------
# Logging
#------------------------------------------------------------------------------
log_timezone = 'Etc/UTC'

#------------------------------------------------------------------------------
# Client & Locale Settings
#------------------------------------------------------------------------------
datestyle = 'iso, mdy'
timezone = 'Etc/UTC'
lc_messages = 'en_US.utf8'
lc_monetary = 'en_US.utf8'
lc_numeric = 'en_US.utf8'
lc_time = 'en_US.utf8'
default_text_search_config = 'pg_catalog.english'
